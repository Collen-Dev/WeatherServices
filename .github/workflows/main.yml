name: C_&_T_BS_Deployment(To IIS)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install Web Deploy
        run: |
          choco install webdeploy -y

      - name: Build Website
        run: |
          # Add your build commands here if needed
          # For example, if your website is .NET-based:
             dotnet publish -c Release -o ./publish

      - name: Deploy to Local IIS
        env:
          SERVER: "192.168.1.103:8080" # Change to your server name or IP
          USERNAME: ${{ secrets.ftp_username }} # Change to your Windows username
          PASSWORD: ${{ secrets.ftp_password }} # Set this secret in your repository's settings
        run: |
          msdeploy -verb:sync -source:contentPath="C:\inetpub\wwwroot\WeatherAPI" -dest:auto,ComputerName="https://%SERVER%/MSDeploy.axd?site=WeatherAPI",UserName="%USERNAME%",Password="%PASSWORD%",AuthType="Basic"
